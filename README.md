---
title: "Instructions"
author: "Dan Myles"
date: "24/07/2019"
output: 
  html_document:
    keep_md: true
    toc: true
    toc_depth: 2
    theme: paper
    highlight: monochrome
---
# 9 Line Slot Task

You can contact me at dan.myles@monash.edu.

## Dependancies

Make sure you have the following software and MATLAB packages installed:

  1. [MATLAB_2021a](http://mathworks.com)
	  i. The statistics and machine learning toolbox is also required
  2. [PsychToolbox-3](http://psychtoolbox.org/)
  3. I installed https://www.xquartz.org/ in order to use the PsychToolbox function DrawFormattedText2
  
## File Structure

  - **output: ** Data generated by the experiment will be outputted here
  - **resources: ** This is where I have kept a number of resources and scripts written by others that were useful in making this task
  - **code: ** All scripts and functions necessary to run the 9LST
    - **functions:** All functions used in this task
    - **config:** Any files necessary for task set up will be located here
    - **instructions:** Participant instructions will all be located here
    - **archived:** Older code that is no longer being used. Delete when task in complete
    - *boot_exp.m* - A MATLAB function to run set_up scripts. Must be located in code directory.
    - *begin_experiment.m* - Run this script to begin the experiment. You may need to modify config files to setup experiment as desired

## Flow

This experiment is broken down into a series of functions. The rough order of operations is something like this:

(see comments within each function for more details):

  1. Experiment Script (contains over-all structure)\
		1. **EVENT MARKER: EXP START**
	  2. This calls "boot_exp.m" which runs a series of set up functions:
		  - Start clock ("tic")
		  - Check Psychtoolbox and Stat toolbox are installed
		  - Set file path
		  - Set up Psychtoolbox screen –> save to "screenInfo"
		  - Set up the slot machine grid –> save to "screenInfo"
		  - Set up reelInfo, creates:
			  - Shape, size and colour information for reel symbols
			  - Possible payout amounts, and display parameters
			  - Position information for the reel positions
			  - The sequence of symbols across the "reel strips"
		  - Set up a table for experiment output (trial by trial)
		  - Set max priority (limit processing power consumed by background activities)
		  - The loading screen function is called throughout to display a little graphic as the experiment progresses through these early set up procedures. Generating the reel strips can take a moment.
		  - Returns to experiment script
	  2.  Display task instructions sequence
		  -  See present_instructions.m
		  -  Record duration of instructions `sessionInfo.instrEndT` when participant presses 9 on the last page
	  3.  Begin experiment proper
		  - **Event Marker: Block Start = []**
		  - **Event Marker: Block End = []**
		  -  The block and trial structure is read off the reelInfo struct.
		  -  Pretty much just a series of nested for loops over the present_trial.m function and it's dependencies.
		4. present_trial.m, loosely the following events:
			- Display betting screen
				- **Event Marker: Display Bet**
	    - Take participant betting choice 
		    - **Event Marker: Display Bet**
	    - Update reelInfo.trialIndex iterator
	    - Update outputData by participant betting choice
	    - Display the spin
		    - **Event Marker: Spin Animation Start**
		    - **Event Marker: Spin Animation End**
			- Highlight any active reels
				- **Event Marker: Highlight Appears**
				- **Event Marker: Highlight Sequence Complete**
			- Display Fixation Cross
				- **Event Marker: Fixation Cross**
			- Display Outcome Stimulus
				- **‌Event Marker: Display Outcome Stimulus**
			- Trial End - Back to main loop
				- **‌Event Marker: Trial End**
		5. Occasional breaks every `` trials
	    - **‌Event Marker: Break Start**
	    - **‌Event Marker: Break End**
	  6. Experiment End
	    - **‌Event Marker: EXP END**

## Trigger Dictionary

Experiment Start - 255
Experiment End   - 254

Break Start - 251
Break End - 252

Block Start - 1
Block End - 2

Trial Start - 3
Trial End - 4

Display Bet - 5

Bet Choice Response - 6
  - Choice
	  - High: 61
	  - Low: 62
  - Key 
	  - Left: 63
	  - Right: 64

Spin Animation Start - 71
Spin Animation End - 72

Highlight Sequence Begin - 81
Highlight Sequence Complete - 82

Highlight Properties
  - Line numbers:
	  1. 91
	  2. 92
	  3. 93
	  4. 94
	  5. 95
	  6. 96
	  7. 97
	  8. 98
	  9. 99
  - Highlighted Quantity
	  1. 41
	  2. 42
	  3. 43  

Display Fixation Cross - 55

Display Outcome Stimulus - 10
   - Loss: 
	   - Bet Low 100
	   - Bet High 200
   - Win: 
	   - Payout
		   - 12: 112
		   - 15: 115
		   - 50: 150
		   - 120: 212
		   - 150: 215
		   - 500: 250
   - LDW:
	   - Payout
		   - 3: 103
		   - 6: 106
		   - 30: 203
		   - 60: 206

Stimulus Properties: 
  - Win line number:
	  1. 191
	  2. 192
	  3. 193
	  4. 194
	  5. 195
	  6. 196
	  7. 197
	  8. 198
	  9. 199
  - Center symbol:
	  - Circle: 11
	  - Diamond: 12
	  - Triangle: 13
	  - Square: 14
	  - Pentagon: 15

## Config

Explanation of how config file works will go here.

May end up having to change "reelInfo" to config? Or have reelInfo read from a config file that the user can pre-set...

## Functions

Explanation of the purpose of each function will go here

## How is the sequence of reel symbols allocated

I felt that the most balanced way to assign the sequence of symbols along the reel would be to include every possible sequence of 3 symbols (for each vertical position). I was familiar with the concept of de Bruijn sequences, in which a set (or "alphabet") of outcomes is ordered into a long cyclic (in that it is repeating) sequence which includes every permutation of some subsequence length (see: https://en.wikipedia.org/wiki/De_Bruijn_sequence). 

I wanted something similar, with the exception that repeats [1, 1, 1] OR [2, 5, 2] would not occur. This was because I did not want cases in which two wins on the same symbol could occur simultaneously. I came across some code to produce a "Katz sequence" which prevents consecutive repeats: 

Brimijoin, W. O., & O'Neill, W. E. (2010). Patterned tone sequences reveal non-linear interactions in auditory spectrotemporal receptive fields in the inferior colliculus. Hearing Research, 267(1-2), 96-110. https://doi.org/10.1016/j.heares.2010.04.005

However, this did not prevent cases in which a repeat occurred within the subsequence non-simultaneously. So it took a bit of editing. Because of the way I came at this problem it had the code to generate deBruij or Katz style reels so I have left that in as an option, see "generate_reelstrip.m".
